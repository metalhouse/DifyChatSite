<!DOCTYPE html>
<html>
<head>
    <title>APIä¿®å¤æµ‹è¯•</title>
</head>
<body>
    <h1>API URLä¿®å¤æµ‹è¯•</h1>
    <div id="test-results"></div>
    <button onclick="testAPI()">æµ‹è¯•APIè°ƒç”¨</button>
    
    <script type="module">
        import { ENV_CONFIG } from './config/env.js';
        import apiClient from './js/api/api-client.js';
        
        window.testAPI = async function() {
            const results = document.getElementById('test-results');
            results.innerHTML = '<p>æµ‹è¯•ä¸­...</p>';
            
            try {
                // è·å–ç™»å½•Token
                const token = localStorage.getItem('dify_access_token');
                if (!token) {
                    results.innerHTML = '<p style="color: red;">âŒ æœªæ‰¾åˆ°ç™»å½•Tokenï¼Œè¯·å…ˆç™»å½•</p>';
                    return;
                }
                
                // æµ‹è¯•ç”¨æˆ·èµ„æ–™API
                console.log('ğŸ” æµ‹è¯•APIè°ƒç”¨...');
                const response = await apiClient.get('/users/profile');
                
                results.innerHTML = `
                    <h3>âœ… APIè°ƒç”¨æˆåŠŸ!</h3>
                    <p><strong>ç”¨æˆ·å:</strong> ${response.data.username}</p>
                    <p><strong>æ˜µç§°:</strong> ${response.data.nickname || 'æœªè®¾ç½®'}</p>
                    <p><strong>é‚®ç®±:</strong> ${response.data.email}</p>
                    <p><strong>è§’è‰²:</strong> ${response.data.role}</p>
                    <details>
                        <summary>å®Œæ•´å“åº”æ•°æ®</summary>
                        <pre>${JSON.stringify(response, null, 2)}</pre>
                    </details>
                `;
                
            } catch (error) {
                console.error('APIæµ‹è¯•å¤±è´¥:', error);
                results.innerHTML = `<p style="color: red;">âŒ APIæµ‹è¯•å¤±è´¥: ${error.message}</p>`;
            }
        };
        
        // é¡µé¢åŠ è½½æ—¶æ˜¾ç¤ºåŸºæœ¬ä¿¡æ¯
        document.getElementById('test-results').innerHTML = `
            <p><strong>ENV_CONFIG.getApiUrl():</strong> ${ENV_CONFIG.getApiUrl()}</p>
            <p><strong>apiClient.baseURL:</strong> ${apiClient.baseURL}</p>
            <p><strong>ç™»å½•Token:</strong> ${localStorage.getItem('dify_access_token') ? 'å·²å­˜åœ¨' : 'æœªæ‰¾åˆ°'}</p>
        `;
    </script>
</body>
</html>

# 🔐 DifyChatSite 认证系统说明

## 📋 认证方式更新

### 后端要求
- **认证方式**: 用户名 + 密码
- **登录字段**: `username` 和 `password`
- **不支持**: 邮箱登录

### 前端适配
已完成以下修改以适配后端：

#### 1. 登录页面 (`login.html`)
```html
<!-- 修改前 -->
<input type="email" id="email" placeholder="请输入邮箱地址">

<!-- 修改后 -->
<input type="text" id="username" placeholder="请输入用户名">
```

#### 2. 表单验证
```javascript
// 修改前: 邮箱验证
const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
if (!emailRegex.test(email)) {
    showToast('请输入有效的邮箱地址', 'error');
    return;
}

// 修改后: 用户名验证
if (username.length < 3) {
    showToast('用户名至少需要3个字符', 'error');
    return;
}
```

#### 3. API 调用
```javascript
// 修改前
await difyApi.login(email, password);

// 修改后
await difyApi.login(username, password);
```

## 🛠️ 技术实现

### API 客户端特性
- ✅ 用户名+密码认证
- ✅ 自动token刷新
- ✅ 演示模式支持
- ✅ 完整错误处理
- ✅ 零外部依赖

### 演示模式配置
```javascript
const API_CONFIG = {
    DEMO_MODE: true,  // 演示模式，无需后端
    BASE_URL: 'http://192.168.1.90:5000/api/v1'
};
```

当 `DEMO_MODE = true` 时：
- 任意用户名（3个字符以上）+ 任意密码可登录
- 返回模拟数据，不依赖后端
- 适合前端开发和演示

当 `DEMO_MODE = false` 时：
- 连接真实后端API
- 使用实际的用户名+密码验证
- 返回真实数据

## 🚀 使用说明

### 1. 开发环境
保持 `DEMO_MODE = true` 进行前端开发

### 2. 生产环境
1. 设置 `API_CONFIG.DEMO_MODE = false`
2. 配置正确的 `API_CONFIG.BASE_URL`
3. 确保后端API可访问

### 3. 测试方法
使用 `api-test.html` 页面测试所有API功能：
- 用户名+密码登录测试
- 智能体列表获取
- 消息发送功能
- 健康检查

## 📝 更新文件列表

已更新的文件：
- ✅ `login.html` - 登录表单
- ✅ `js/api/dify-api.js` - API客户端
- ✅ `api-test.html` - API测试页面
- ✅ `index.html` - 首页错误修复

## 🔍 验证清单

登录功能验证：
- [ ] 用户名字段显示正确
- [ ] 用户名验证（最少3个字符）
- [ ] 密码验证正常
- [ ] 演示模式登录成功
- [ ] 错误提示准确

API 功能验证：
- [ ] 健康检查正常
- [ ] 智能体列表获取
- [ ] 消息发送功能
- [ ] Token 自动刷新

## ⚠️ 注意事项

1. **演示模式**: 当前为演示模式，所有数据为模拟数据
2. **生产部署**: 需要将 `DEMO_MODE` 设为 `false` 并配置正确的后端地址
3. **安全性**: 确保后端API支持CORS或配置代理
4. **兼容性**: 认证系统完全符合后端API文档要求

---

**当前状态**: ✅ 认证系统已完全适配后端用户名+密码方式

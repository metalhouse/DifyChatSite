/* ç§»åŠ¨ç«¯å›¾ç‰‡æ˜¾ç¤ºä¿®å¤ */

/* ç§»åŠ¨ç«¯å›¾ç‰‡ä¼˜åŒ– */
@media (max-width: 768px) {
    /* å¼ºåˆ¶æ˜¾ç¤ºå›¾ç‰‡æ¶ˆæ¯ - æœ€é«˜ä¼˜å…ˆçº§ */
    .message-image {
        max-width: 250px !important;
        max-height: 180px !important;
        width: auto !important;
        height: auto !important;
        object-fit: cover !important;
        border-radius: 8px !important;
        cursor: pointer !important;
        touch-action: manipulation !important;
        /* å¼ºåˆ¶æ˜¾ç¤º */
        display: block !important;
        visibility: visible !important;
        opacity: 1 !important;
        /* é˜²æ­¢è¢«å…¶ä»–æ ·å¼è¦†ç›– */
        position: relative !important;
        z-index: 1 !important;
    }
    
    /* ä¿®å¤å¯èƒ½çš„éšè—é—®é¢˜ */
    .message-attachments {
        display: block !important;
        visibility: visible !important;
        margin-top: 8px !important;
        max-width: 100% !important;
        overflow: visible !important;
    }
    
    /* ç¡®ä¿æ¶ˆæ¯æ°”æ³¡ä¸ä¼šéšè—å›¾ç‰‡ */
    .message-bubble {
        overflow: visible !important;
    }
    
    /* å›¾ç‰‡å®¹å™¨ä¿®å¤ */
    .message-attachments img {
        display: block !important;
        visibility: visible !important;
        opacity: 1 !important;
    }
    
    /* å›¾ç‰‡ä¸Šä¼ æŒ‰é’®åœ¨ç§»åŠ¨ç«¯çš„ä¼˜åŒ– */
    #imageUploadButton {
        min-height: 44px !important; /* iOSæ¨èçš„æœ€å°è§¦æ‘¸åŒºåŸŸ */
        min-width: 44px !important;
        touch-action: manipulation !important; /* é˜²æ­¢åŒå‡»ç¼©æ”¾ */
        -webkit-touch-callout: none !important; /* ç¦ç”¨é•¿æŒ‰èœå• */
        user-select: none !important;
        /* å¼ºåˆ¶å¯ç”¨ */
        opacity: 1 !important;
        pointer-events: auto !important;
        cursor: pointer !important;
    }
    
    /* ç¡®ä¿æ–‡ä»¶è¾“å…¥æ¡†åœ¨ç§»åŠ¨ç«¯èƒ½æ­£ç¡®è§¦å‘ */
    #imageFileInput,
    #cameraFileInput {
        position: absolute !important;
        left: -9999px !important;
        opacity: 0 !important;
        pointer-events: none !important;
    }
    
    /* å›¾ç‰‡åŠ è½½é”™è¯¯æ—¶çš„æ ·å¼ */
    .message-image[src=""],
    .message-image:not([src]) {
        display: none !important;
    }
    
    /* å›¾ç‰‡æ¨¡æ€æ¡†åœ¨ç§»åŠ¨ç«¯çš„ä¼˜åŒ– */
    #imageModal,
    #forceImageSourceModal {
        padding: 10px !important;
        box-sizing: border-box !important;
    }
    
    #imageModal img {
        max-width: 95% !important;
        max-height: 95% !important;
        object-fit: contain !important;
    }
    
    /* å›¾ç‰‡åŠ è½½å¤±è´¥æç¤ºåœ¨ç§»åŠ¨ç«¯çš„ä¼˜åŒ– */
    .image-error-message {
        padding: 8px 12px !important;
        background: #f8f9fa !important;
        border: 1px solid #dee2e6 !important;
        border-radius: 6px !important;
        color: #6c757d !important;
        font-size: 0.9rem !important;
        text-align: center !important;
        max-width: 250px !important;
        display: block !important;
    }
    
    /* åŠ è½½ä¸­çŠ¶æ€ */
    .image-loading {
        padding: 20px !important;
        text-align: center !important;
        background: #f8f9fa !important;
        border-radius: 6px !important;
        color: #6c757d !important;
        max-width: 250px !important;
        display: block !important;
    }
    
    .image-loading::before {
        content: "ğŸ“¸ " !important;
        display: inline-block !important;
        animation: pulse 1.5s ease-in-out infinite !important;
    }
    
    @keyframes pulse {
        0% { opacity: 1; }
        50% { opacity: 0.5; }
        100% { opacity: 1; }
    }

    /* ä¿®å¤WebKitæµè§ˆå™¨çš„å›¾ç‰‡æ˜¾ç¤ºé—®é¢˜ */
    .message-image {
        -webkit-transform: translateZ(0) !important;
        transform: translateZ(0) !important;
        backface-visibility: hidden !important;
        -webkit-backface-visibility: hidden !important;
    }

    /* å¼ºåˆ¶é‡ç»˜ä¿®å¤ */
    .message-attachments {
        transform: translateZ(0) !important;
        -webkit-transform: translateZ(0) !important;
    }
}

/* é«˜DPIæ˜¾ç¤ºå±ä¼˜åŒ– */
@media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
    .message-image {
        image-rendering: -webkit-optimize-contrast;
        image-rendering: crisp-edges;
    }
}

/* è§¦æ‘¸è®¾å¤‡ä¸“ç”¨æ ·å¼ */
@media (hover: none) and (pointer: coarse) {
    .message-image:hover {
        transform: none; /* ç§»é™¤hoveræ•ˆæœ */
    }
    
    .message-image:active {
        transform: scale(0.98);
        transition: transform 0.1s ease;
    }
}
